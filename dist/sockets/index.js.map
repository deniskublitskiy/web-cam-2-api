{"version":3,"sources":["sockets/index.js"],"names":["io","on","socket","console","log","params","id","handshake","query","userId","options","withRelated","require","User","forge","fetch","user","related","forEach","join","chat","get","to","chatId","emit"],"mappings":";;;;;;;;;;kBAEe,UAASA,EAAT,EAAa;AAAA;;AACxBA,OAAGC,EAAH,CAAM,YAAN;AAAA,gEAAoB,iBAAMC,MAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAChBC,oCAAQC,GAAR,CAAY,WAAZ;AACAF,mCAAOD,EAAP,CAAU,YAAV,EAAwB;AAAA,uCAAME,QAAQC,GAAR,CAAY,cAAZ,CAAN;AAAA,6BAAxB;;AAEIC,kCAJY,GAIH;AACTC,oCAAIJ,OAAOK,SAAP,CAAiBC,KAAjB,CAAuBC;AADlB,6BAJG;AAOZC,mCAPY,GAOF;AACVC,6CAAa,CAAC,OAAD,CADH;AAEVC,yCAAS;AAFC,6BAPE;AAAA;AAAA;AAAA,mCAaKC,KAAKC,KAAL,CAAWT,MAAX,EAAmBU,KAAnB,CAAyBL,OAAzB,CAbL;;AAAA;AAaRM,gCAbQ;;AAcZA,iCAAKC,OAAL,CAAa,OAAb,EAAsBC,OAAtB,CAA8B;AAAA,uCAAQhB,OAAOiB,IAAP,gBAAyBC,KAAKC,GAAL,CAAS,IAAT,CAAzB,CAAR;AAAA,6BAA9B;AAdY;AAAA;;AAAA;AAAA;AAAA;;AAgBZlB,oCAAQC,GAAR;;AAhBY;;AAmBhBF,mCAAOD,EAAP,CAAU,eAAV,EAA2B,kBAAU;AACjCC,uCAAOoB,EAAP,gBAAuBC,MAAvB,EAAiCC,IAAjC,CAAsC,eAAtC,EAAuDD,MAAvD;AACH,6BAFD;;AAnBgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAApB;;AAAA;AAAA;AAAA;AAAA;AAuBH,C;;;;;;eA1BcX,QAAQ,iBAAR,C;IAARC,I,YAAAA,I","file":"index.js","sourcesContent":["const {User} = require('../models/index');\r\n\r\nexport default function(io) {\r\n    io.on('connection', async socket => {\r\n        console.log('Connected');\r\n        socket.on('disconnect', () => console.log('Disconnected'));\r\n\r\n        let params = {\r\n            id: socket.handshake.query.userId\r\n        };\r\n        let options = {\r\n            withRelated: ['chats'],\r\n            require: true\r\n        };\r\n\r\n        try {\r\n            let user = await User.forge(params).fetch(options);\r\n            user.related('chats').forEach(chat => socket.join(`chat-room-${chat.get('id')}`));\r\n        } catch (e) {\r\n            console.log(e);\r\n        }\r\n\r\n        socket.on('start_calling', chatId => {\r\n            socket.to(`chat-room-${chatId}`).emit('start_calling', chatId)\r\n        });\r\n    })\r\n}"]}